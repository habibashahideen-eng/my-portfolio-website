<!DOCTYPE html>
<html lang="en" class="bg-white text-gray-900 dark:bg-gray-900 dark:text-white transition-colors">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather App</title>

  <!-- Tailwind Config (before Tailwind CDN) -->
  <script>
    tailwind.config = {
      darkMode: 'class'
    }
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body
  class="min-h-screen flex items-center justify-center p-4 transition-colors duration-700 bg-cover bg-center bg-no-repeat"
  id="app-body"
  style="background-image: url('images/hhhhhiiuiui.jpg');"
>

  <div
    class="w-full max-w-md p-6 rounded-2xl shadow-lg bg-gray-100 dark:bg-gray-800 bg-opacity-90 backdrop-blur-md transition-colors"
  >
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-2xl font-bold">Weather in Pakistan</h1>
      <button
        id="toggle-theme"
        class="bg-gray-300 dark:bg-gray-700 p-2 rounded hover:scale-105 transition"
       aria-label="Toggle light and dark mode"
      >
        ðŸŒž/ðŸŒ™
      </button>
    </div>

    <select
      id="city-select"
      class="w-full p-2 rounded bg-white dark:bg-gray-700 text-black dark:text-white mb-4"
      aria-label="Select city"
    >
      <option>Karachi</option>
      <option>Lahore</option>
      <option>Islamabad</option>
      <option>Peshawar</option>
      <option>Sialkot</option>
      <option>Murree</option>
      <option>Hyderabad</option>
      <option>Multan</option>
      <option>Quetta</option>
    </select>

    <div id="weather-display" class="text-center space-y-2" aria-live="polite">
      <p class="text-lg font-medium">Select a city to see weather</p>
    </div>

    <div id="forecast-display" class="mt-6" aria-live="polite"></div>
  </div>

  <script>
    const apiKey = "bd230f53c135296924e837fa7828f8aa";
    const weatherDisplay = document.getElementById("weather-display");
    const forecastDisplay = document.getElementById("forecast-display");
    const citySelect = document.getElementById("city-select");
    const themeToggle = document.getElementById("toggle-theme");
    const html = document.documentElement;
    const appBody = document.getElementById("app-body");

    // Background images
    const lightBackground = "images/hhhhhiiuiui.jpg";
    const darkBackground =
      "https://images.unsplash.com/photo-1462331940025-496dfbfc7564?auto=format&fit=crop&w=1350&q=80";

    const cityImages = {
      Karachi:
       "images/quaid e azam (1).jpg",
      Lahore:
        "images/badshahi mosque (1).jpg",
      Islamabad:
        "images/faisal mosque.jpg",
      Peshawar:
        "images/khyber pass.jpg",
      Sialkot:
        "images/sialkot clock tower.jpg",
      Murree:
        "images/mall road murree.webp",
      Hyderabad:
        "images/charminar hyderabad (1).jpg",
      Multan:
        "images/multan.webp",
      Quetta:
       "images/quetta.jpeg",
    };

    // Set default theme and background based on system preference
    if (window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches) {
      html.classList.add("dark");
      appBody.style.backgroundImage = `url('${darkBackground}')`;
    } else {
      appBody.style.backgroundImage = `url('${lightBackground}')`;
    }

    // Toggle theme on button click
    themeToggle.addEventListener("click", () => {
      html.classList.toggle("dark");
      if (html.classList.contains("dark")) {
        appBody.style.backgroundImage = `url('${darkBackground}')`;
      } else {
        appBody.style.backgroundImage = `url('${lightBackground}')`;
      }
    });

    async function fetchWeather(city) {
      weatherDisplay.innerHTML = `<p>Loading weather for ${city}...</p>`;
      forecastDisplay.innerHTML = "";

      try {
        const res = await fetch(
          `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`
        );
        const data = await res.json();

        if (data.cod !== 200) {
          weatherDisplay.innerHTML = `<p class="text-red-500">Error: ${data.message}</p>`;
          return;
        }

        const icon = data.weather[0].icon;
        const temp = data.main.temp;
        const desc = data.weather[0].description;
        const cityImageUrl = cityImages[city] || "";

        weatherDisplay.innerHTML = `
          <img src="https://openweathermap.org/img/wn/${icon}@4x.png" alt="${desc}" class="mx-auto w-28 h-28" />
          <h2 class="text-3xl font-semibold flex items-center justify-center space-x-3">
            <img src="${cityImageUrl}" alt="${city}" class="w-[88px] h-20 rounded-md object-cover" />
            <span>${city}</span>
          </h2>
          <p class="text-xl capitalize">${desc}</p>
          <p class="text-4xl font-bold">${temp}Â°C</p>
        `;

        const forecastRes = await fetch(
          `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric`
        );
        const forecastData = await forecastRes.json();

        if (forecastData.cod !== "200") {
          forecastDisplay.innerHTML = `<p class="text-red-500">Error fetching forecast: ${forecastData.message}</p>`;
          return;
        }

        const forecastList = forecastData.list;
        const dailyForecast = {};

        forecastList.forEach((item) => {
          const date = item.dt_txt.split(" ")[0];
          if (!dailyForecast[date]) {
            dailyForecast[date] = [];
          }
          dailyForecast[date].push(item);
        });

        function getBestForecastForDay(dayData) {
          const targetHour = 12;
          let best = dayData[0];
          let minDiff = Math.abs(new Date(best.dt_txt).getHours() - targetHour);
          dayData.forEach((d) => {
            const hour = new Date(d.dt_txt).getHours();
            const diff = Math.abs(hour - targetHour);
            if (diff < minDiff) {
              best = d;
              minDiff = diff;
            }
          });
          return best;
        }

        let forecastHTML = '<h3 class="text-xl font-semibold mb-4">5-Day Forecast</h3><div class="space-y-4">';
        let count = 0;
        for (let date in dailyForecast) {
          if (count >= 5) break;
          const bestDayData = getBestForecastForDay(dailyForecast[date]);
          const icon = bestDayData.weather[0].icon;
          const description = bestDayData.weather[0].description;
          const temp = bestDayData.main.temp;
          const dayName = new Date(date).toLocaleDateString("en-US", { weekday: "long" });

          forecastHTML += `
            <div class="flex items-center space-x-4 p-3 bg-white dark:bg-gray-700 rounded-lg shadow-md">
              <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="${description}" class="w-12 h-12" />
              <div>
                <p class="font-semibold text-lg">${dayName}</p>
                <p class="capitalize">${description}</p>
              </div>
              <div class="ml-auto text-2xl font-bold">${temp}Â°C</div>
            </div>
          `;
          count++;
        }
        forecastHTML += "</div>";
        forecastDisplay.innerHTML = forecastHTML;
      } catch (err) {
        weatherDisplay.innerHTML = `<p class="text-red-500">Failed to load data.</p>`;
      }
    }

    citySelect.addEventListener("change", () => {
      const city = citySelect.value;
      fetchWeather(city);
    });

    window.addEventListener("load", () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          async (position) => {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;

            try {
              const res = await fetch(
                `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`
              );
              const data = await res.json();

              const city = data.name;
              if (
                [...citySelect.options].some(
                  (opt) => opt.value.toLowerCase() === city.toLowerCase()
                )
              ) {
                citySelect.value = city;
                fetchWeather(city);
              } else {
                citySelect.value = "Karachi";
                fetchWeather("Karachi");
              }
            } catch (err) {
              citySelect.value = "Karachi";
              fetchWeather("Karachi");
            }
          },
          () => {
            citySelect.value = "Karachi";
            fetchWeather("Karachi");
          }
        );
      } else {
        citySelect.value = "Karachi";
        fetchWeather("Karachi");
      }
    });
  </script>



</body>
</html>
